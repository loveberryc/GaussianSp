# PhysX-Boosted: 物理增强的4D高斯动态重建

## 组会汇报 PPT 脚本

---

## Slide 1: 封面

**标题**: PhysX-Boosted: 融合物理锚点与神经场的4D动态重建

**副标题**: 基于X²-Gaussian的物理增强方法

**日期**: 2025年12月5日

---

## Slide 2: 研究背景与动机

### 问题背景
- 4D CT重建在放疗计划、呼吸运动分析中至关重要
- 现有方法(如X²-Gaussian)使用HexPlane+MLP建模时间形变
- **问题**: 纯隐式方法缺乏显式物理约束，对不规则呼吸泛化能力有限

### 研究动机
1. **物理可解释性**: 解剖结构间存在物理牵引关系（如肋骨-膈肌联动）
2. **鲁棒性需求**: 临床场景中呼吸节律往往不规则
3. **稀疏观测**: 低剂量CT需要从更少视角重建

---

## Slide 3: 方法概述 - PhysX-Boosted架构

### 核心思想: "神经场 + 物理骨架"双流融合

```
                    ┌─────────────────┐
                    │   Input: μ, t   │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              ▼                             ▼
    ┌─────────────────┐           ┌─────────────────┐
    │  HexPlane分支   │           │  Anchor分支     │
    │  (神经纹理)     │           │  (物理骨架)     │
    │                 │           │                 │
    │  6个特征平面    │           │  1024个锚点     │
    │  + MLP解码      │           │  + Transformer  │
    │                 │           │  + KNN蒙皮     │
    └────────┬────────┘           └────────┬────────┘
             │                              │
             │  Δx_hex                      │  Δx_anchor
             │                              │
             └──────────────┬───────────────┘
                            ▼
              ┌─────────────────────────┐
              │  可学习融合: α ∈ [0,1]  │
              │  Δx = (1-α)·Δx_hex      │
              │      + α·Δx_anchor      │
              └─────────────────────────┘
```

---

## Slide 4: Anchor Transformer详解

### 1. 锚点初始化 (FPS采样)
- 从初始点云采样1024个代表性锚点
- 锚点代表解剖关键位置

### 2. Spacetime Transformer
- 每个锚点编码: 位置嵌入 + 时间嵌入
- 自注意力机制学习锚点间交互
- 输出: 每个锚点的位移 Δa_k

### 3. KNN蒙皮插值
- 每个高斯绑定k=10个最近锚点
- 距离反比权重: w_ij = softmax(-d_ij / σ)
- 高斯位移: Δμ_i = Σ w_ij · Δa_j

---

## Slide 5: Masked Modeling训练策略

### BERT式掩码预训练

**训练时**:
1. 随机mask 25%锚点，替换为[MASK] token
2. Transformer需要从未mask锚点"推断"被mask锚点的运动
3. L_phys = ||预测位移 - 真实位移||

**目的**:
- 学习锚点间的物理牵引关系
- 例如: 肋骨抬起 → 膈肌下降

**测试时**:
- 不mask，全力输出

---

## Slide 6: Masked Modeling改进探索

### 问题发现
实验显示 mask=0 与 mask=0.25 结果相近，BERT式mask训练效果有限

### 原因分析
```
BERT (NLP):
  预训练: 只有 L_mask（无监督）→ 模型被迫学习语义
  微调:   L_task（有监督）

当前实现:
  训练: L_render（强监督）+ λ·L_phys（辅助）
  问题: L_render太强，模型可以"绕过"mask直接拟合
```

### 三种改进方案

| 版本 | 策略 | 核心思想 |
|------|------|----------|
| **V10** | 解耦式Mask | 渲染用unmasked，L_phys用masked |
| **V11** | 预训练-微调 | Stage1只用L_phys，Stage2正常渲染 |
| **V12** | 时间Mask | mask整个时间步而非随机锚点 |

---

## Slide 6.1: V10 - 解耦式掩码建模

### 原版问题
渲染时使用带mask的结果 → 渲染质量受损

### V10改进
```
原版:
  forward(mask) → render → L_render  ← mask影响渲染

V10:
  forward(无mask) → render → L_render  ← 全力输出
  forward(有mask) → L_phys            ← 单独监督表征
```

**优势**: 渲染质量最优 + 表征学习解耦

---

## Slide 6.2: V11 - 预训练-微调范式（最BERT）

### 核心思想
真正模仿BERT：先纯物理预训练，再渲染微调

```
┌─────────────────────────────────────────────────────────┐
│  Stage 1 (Pretrain): 3000 steps                         │
│  ├── mask_ratio = 0.5 (更高)                            │
│  ├── Loss = L_phys only (无渲染！)                      │
│  ├── 跳过 densification（无渲染梯度）                   │
│  └── 模型被迫从其他锚点推断被mask锚点的运动             │
├─────────────────────────────────────────────────────────┤
│  Stage 2 (Finetune): 47000 steps                        │
│  ├── mask_ratio = 0.25 (正常)                           │
│  ├── Loss = L_render + L_phys                           │
│  └── 保留预训练学到的物理知识                           │
└─────────────────────────────────────────────────────────┘
```

**关键**: 无L_render的"捷径"，必须学习物理关系

---

## Slide 6.3: V12 - 时间Mask（更有物理意义）

### 传统空间Mask vs 时间Mask

```
传统 (空间Mask):
  在 t=0.3 时刻，随机选25%锚点mask
  问题: 空间上相邻锚点可以"抄答案"

V12 (时间Mask):
  随机选25%时间步，mask该时刻ALL锚点
  例如: 给定 t=0,0.1,0.2,0.4,0.5 的运动
       mask掉 t=0.3，预测该时刻所有锚点运动
```

### 物理意义
- 学习**时间连续性**: 从前后帧推断中间帧
- 学习**物理动力学**: 运动的加速度、惯性
- 更接近实际问题: 预测未见过的呼吸相位

---

## Slide 7: 实验设置

### 数据集
| 数据集 | 描述 | 训练视角 |
|--------|------|----------|
| case1 | 原始4D CT | 300 |
| noise0.5 | 50%周期扰动 | 300 |
| sparse20 | 超稀疏视角 | 60 |

### 对比方法
1. **Baseline**: X²-Gaussian (HexPlane+MLP)
2. **PhysX-Boosted (mask=0)**: 无mask训练
3. **PhysX-Boosted (mask=0.25)**: 有mask训练
4. **V10**: 解耦式mask训练
5. **V11**: 预训练-微调范式 (🔄 运行中)
6. **V12**: 时间Mask (🔄 运行中)

---

## Slide 8: 实验结果 - 标准数据集

### Case1 (原始数据集) @ 50000 iterations

| 方法 | PSNR_3D ↑ | SSIM_3D ↑ | 提升 |
|------|-----------|-----------|------|
| Baseline (HexPlane) | 44.616 | 0.978 | - |
| PhysX-Boosted (mask=0.25) | 45.078 | 0.980 | +0.46 dB |
| PhysX-Boosted (mask=0) | 45.117 | 0.980 | +0.50 dB |
| **V10 (解耦mask)** | **45.141** | **0.980** | **+0.52 dB** |
| V11 (预训练-微调) | 🔄 | 🔄 | 🔄 |
| V12 (时间Mask) | 🔄 | 🔄 | 🔄 |

### 关键发现
- Anchor Transformer本身带来显著提升 (+0.5 dB)
- V10略优于其他变体
- V11/V12 实验进行中，预期效果待验证

---

## Slide 9: 实验结果 - 鲁棒性测试

### Noise0.5 (周期扰动) @ 50000 iterations

| 方法 | PSNR_3D ↑ | SSIM_3D ↑ |
|------|-----------|-----------|
| PhysX-Boosted (mask=0.25) | 37.969 | 0.954 |
| PhysX-Boosted (mask=0) | 38.353 | 0.957 |
| **V10 (解耦mask)** | **38.409** | **0.958** |

### Sparse20 (稀疏视角) @ 50000 iterations

| 方法 | PSNR_3D ↑ | SSIM_3D ↑ |
|------|-----------|-----------|
| PhysX-Boosted (mask=0.25) | 42.832 | 0.968 |
| PhysX-Boosted (mask=0) | 42.972 | 0.969 |
| V10 (解耦mask) | 42.917 | 0.969 |

---

## Slide 10: 结果分析

### 主要发现

1. **Anchor Transformer有效**
   - 在所有数据集上超越Baseline
   - 物理锚点+自注意力建模运动模式更合理

2. **Mask训练的作用有限**
   - mask=0 ≈ mask=0.25
   - 可能原因: 测试时不mask，学到的"推断能力"未被利用

3. **V10在困难数据上略优**
   - noise0.5上V10最佳
   - 解耦设计保证渲染质量不受mask影响

---

## Slide 11: 方法创新点总结

### 1. PhysX-Boosted双流架构
- 首次将物理锚点Transformer与HexPlane融合
- 可学习α参数自适应平衡两个分支

### 2. BERT式掩码建模探索
- 发现直接应用mask效果有限（L_render太强）
- 提出三种改进策略:
  - **V10**: 解耦渲染与mask训练
  - **V11**: 纯物理预训练 + 渲染微调
  - **V12**: 时间维度mask（更有物理意义）

### 3. 系统性消融与分析
- 渲染与表征学习解耦
- 保证渲染质量同时学习鲁棒表征

---

## Slide 12: 后续工作计划

### 本周
1. ✅ 完成V10实验，验证解耦mask有效性
2. 🔄 V11/V12实验进行中
3. 🔄 Baseline在noise0.5/sparse20上对比

### 下周
1. 分析V11/V12结果，确定最佳mask策略
2. 更极端扰动测试(noise1.0, sparse10)
3. 跨相位泛化测试

### 中期
1. 在更多数据集上验证(XCAT, S01)
2. 消融实验: α值、锚点数量、transformer层数
3. 可视化锚点运动模式

### 长期
1. 实时推理优化
2. 临床数据验证
3. 论文撰写

---

## Slide 13: 总结

### 贡献
1. 提出PhysX-Boosted: 物理增强的4D高斯动态重建方法
2. 设计Anchor Transformer学习解剖结构间物理关系
3. V10解耦训练策略兼顾渲染质量与表征鲁棒性

### 实验验证
- 标准数据集: PSNR提升0.5+ dB
- 扰动数据集: 保持稳定性能
- 稀疏视角: 显著优于退化

### 代码
- 完整实现在 `x2_gaussian/gaussian/anchor_module.py`
- 版本迭代: V1→V5→V10→V11/V12

---

## 附录: 版本演进

| 版本 | 核心改进 | 状态 |
|------|----------|------|
| V1 | 基础Anchor Transformer | ✅ |
| V2 | Mask Decay调度 | ✅ |
| V3 | Hybrid (Anchor+轻量HexPlane) | ✅ |
| V4 | Taylor一阶仿射展开 | ✅ |
| V5 | Boosted双流融合 + 可学习α | ✅ 主力 |
| V6/V8 | 正交梯度投影 | ✅ |
| V7 | 不确定性融合 | ✅ |
| V10 | 解耦式掩码建模 | ✅ +0.52dB |
| **V11** | **预训练-微调范式** | 🔄 运行中 |
| **V12** | **时间Mask** | 🔄 运行中 |

---

## 附录: 关键代码位置

| 功能 | 文件 |
|------|------|
| Anchor模块 | `x2_gaussian/gaussian/anchor_module.py` |
| 参数定义 | `x2_gaussian/arguments/__init__.py` |
| 训练逻辑 | `train.py` |
| 数据生成 | `tools/create_robustness_datasets.py` |

